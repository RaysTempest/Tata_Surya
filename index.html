<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jelajah Antariksa - Media Pembelajaran Tata Surya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #00001a;
            color: white;
            overflow: hidden;
            cursor: grab;
        }
        /* Tailwind-inspired kid-friendly palette (CSS variables) */
        :root {
            --bg-900: #04071a;
            --primary: #60a5fa;
            --primary-2: #06b6d4;
            --accent: #f472b6;
            --cta-from: #3b82f6;
            --cta-to: #06b6d4;
            --cta-glow: rgba(99,102,241,0.18);
            --label-bg: linear-gradient(90deg, rgba(3,7,30,0.85), rgba(6,10,30,0.7));
        }
        
        /* --- Animasi Intro --- */
        #splash-screen {
            background: linear-gradient(135deg, #00001a, #0c0c3b);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        
        .logo-container {
            position: relative;
            width: 200px;
            height: 200px;
            animation: fadeInLogo 2s ease-out;
        }
        
        .logo-sun {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ffcc00, #ff9900);
            border-radius: 50%;
            position: absolute;
            top: 50px;
            left: 50px;
            box-shadow: 0 0 40px #ffcc00, 0 0 80px #ff9900;
        }
        
        .logo-orbit {
            position: absolute;
            border: 2px solid rgba(255, 165, 0, 0.5);
            border-radius: 50%;
            animation: spin 20s linear infinite;
        }
        
        .logo-orbit:nth-child(2) { width: 150px; height: 150px; top: 25px; left: 25px; animation-duration: 15s; }
        .logo-orbit:nth-child(3) { width: 200px; height: 200px; top: 0; left: 0; animation-duration: 25s; }
        
        .logo-planet {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: absolute;
        }
        
        .logo-planet1 { background-color: #4a90e2; top: -10px; left: 65px; }
        .logo-planet2 { background-color: #d0021b; top: 80px; left: -10px; }
        
        #splash-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-top: 2rem;
            letter-spacing: 5px;
            background: linear-gradient(90deg, #ffcc00, #ff6b81, #4a90e2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fadeInTitle 3s ease-out;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        @keyframes fadeInLogo { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeInTitle { from { opacity: 0; letter-spacing: 20px; } to { opacity: 1; letter-spacing: 5px; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- Tombol Mulai --- */
        #start-container {
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s ease-in-out, visibility 1s;
        }
        #start-button {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        #start-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px #4a90e2;
        }

        /* --- Tata Surya --- */
        #solar-system-viewport {
            position: fixed;
            inset: 0;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s ease-in-out;
            touch-action: none; /* enable custom touch handling (pinch/pan) */
        }
        #solar-system-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            transition: transform 0.2s ease-out;
        }
        .sun {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffd700, #ff8c00);
            box-shadow: 0 0 50px #ffd700, 0 0 100px #ff8c00;
            position: absolute;
            top: -50px;
            left: -50px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .sun:hover { transform: scale(1.1); }
        .orbit {
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            position: absolute;
            transform-style: preserve-3d;
            animation: orbit-spin linear infinite;
        }
        .planet {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: -10px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }
        .planet img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .planet:hover {
            transform: scale(1.8);
            box-shadow: 0 0 28px rgba(255,255,255,0.9);
        }

        /* Planet self-rotation (axis spin) */
        @keyframes planet-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .planet.spin {
            animation: planet-spin 8s linear infinite;
        }

        /* Ukuran dan kecepatan orbit planet */
        .mercury-orbit { width: 150px; height: 150px; top: -75px; left: -75px; animation-duration: 8.8s; }
        .mercury { width: 8px; height: 8px; top: -4px; background-color: #a9a9a9; }
        
        .venus-orbit { width: 220px; height: 220px; top: -110px; left: -110px; animation-duration: 22.5s; }
        .venus { width: 12px; height: 12px; top: -6px; background-color: #e6e6e6; }

    .earth-orbit { width: 300px; height: 300px; top: -150px; left: -150px; animation-duration: 36.5s; }
    /* Earth is a small circle; wrapped so a moon can orbit it */
    .earth { width: 14px; height: 14px; top: -7px; background: linear-gradient(135deg, #4a90e2, #90ee90, #ffffff); border-radius: 50%; position: absolute; overflow: visible; }
    .earth-wrapper { position: absolute; width: 14px; height: 14px; top: -7px; left: 50%; transform: translateX(-50%); }

    /* Moon orbiting Earth */
    .moon-orbit { position: absolute; width: 70px; height: 70px; top: -28px; left: -28px; border-radius: 50%; transform-origin: 50% 50%; animation: moon-orbit 6s linear infinite; pointer-events: none; }
    .moon { width: 6px; height: 6px; background: #ddd; border-radius: 50%; position: absolute; top: 50%; left: 100%; transform: translate(-50%, -50%); box-shadow: 0 0 8px rgba(255,255,255,0.2); pointer-events: auto; }

    @keyframes moon-orbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .mars-orbit { width: 380px; height: 380px; top: -190px; left: -190px; animation-duration: 68.7s; }
        .mars { width: 10px; height: 10px; top: -5px; background-color: #c1440e; }

        .jupiter-orbit { width: 550px; height: 550px; top: -275px; left: -275px; animation-duration: 120s; }
        .jupiter { width: 40px; height: 40px; top: -20px; background: radial-gradient(#d8ca9f, #a08f5a); }

    .saturn-orbit { width: 750px; height: 750px; top: -375px; left: -375px; animation-duration: 295s; }
    .saturn { width: 35px; height: 35px; top: -17.5px; background: radial-gradient(#e9d9b8, #c9b089); border-radius: 50%; position: absolute; }
    /* Saturn rings: two layered pseudo-elements for depth and tilt */
    .saturn::before { content: ''; position: absolute; top: 12px; left: -30px; width: 100px; height: 14px; background: rgba(200,180,140,0.06); border: 2px solid rgba(165,145,109,0.6); border-radius: 50%; transform: rotate(-20deg); box-shadow: 0 6px 18px rgba(0,0,0,0.4) inset; }
    .saturn::after { content: ''; position: absolute; top: 18px; left: -6px; width: 56px; height: 8px; background: rgba(220,200,160,0.05); border: 1px solid rgba(160,140,110,0.5); border-radius: 50%; transform: rotate(-24deg); }

        .uranus-orbit { width: 900px; height: 900px; top: -450px; left: -450px; animation-duration: 840s; }
        .uranus { width: 25px; height: 25px; top: -12.5px; background-color: #b0e0e6; }

        .neptune-orbit { width: 1050px; height: 1050px; top: -525px; left: -525px; animation-duration: 1650s; }
        .neptune { width: 24px; height: 24px; top: -12px; background-color: #3f51b5; }
        
        .planet-label {
            position: absolute;
            background: var(--label-bg);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            opacity: 0;
            transition: opacity 0.22s, transform 0.18s;
            pointer-events: none;
            white-space: nowrap;
            transform-origin: left center;
            box-shadow: 0 10px 28px rgba(2,6,23,0.6);
            border: 1px solid rgba(255,255,255,0.04);
            color: #fff;
        }
        .planet:hover + .planet-label {
            opacity: 1;
        }

        /* Close-up bottom panel (friendly card) */
        #closeup-panel {
            position: fixed;
            left: 50%;
            transform: translateX(-50%) translateY(110%);
            bottom: 0;
            width: min(920px, 96%);
            background: linear-gradient(180deg, rgba(6,16,40,0.98), rgba(3,8,30,0.99));
            border-radius: 18px 18px 0 0;
            padding: 16px;
            box-shadow: 0 -18px 40px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.02);
            z-index: 60;
            transition: transform 300ms cubic-bezier(.2,.9,.2,1);
            color: white;
            border: 1px solid rgba(255,255,255,0.04);
        }
        #closeup-panel.open { transform: translateX(-50%) translateY(0%); }
    #closeup-panel .thumb { width: 180px; height: 120px; object-fit: cover; border-radius: 12px; box-shadow: 0 10px 38px rgba(2,6,23,0.7); border: 2px solid rgba(255,255,255,0.04); }
    #closeup-panel .title { font-size: 1.8rem; color: #ffea8a; }
    #closeup-panel .desc { font-size: 1rem; color: #dbeafe; line-height: 1.35; }
        /* Moon label: when moon is hovered, reveal next .planet-label (placed on wrapper) */
        .moon:hover + .planet-label,
        .moon:hover ~ .planet-label {
            opacity: 1;
        }

        @keyframes orbit-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Mode classes: mode-spin = planets also spin on axis; mode-static = planets do not spin and labels are visible */
    .mode-spin .planet.spin { animation: planet-spin 8s linear infinite; }
    .mode-static .planet { animation: none !important; }
    .mode-static .planet-label { opacity: 1 !important; }
        
        /* --- Bintang dan Efek --- */
        #stars-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .shooting-star {
            position: fixed;
            height: 2px;
            background: linear-gradient(-45deg, rgba(158, 215, 255, 1), rgba(0, 0, 0, 0));
            border-radius: 999px;
            filter: drop-shadow(0 0 6px rgba(188, 230, 255, 1));
            animation: tail 3s ease-in-out infinite, shooting 3s ease-in-out infinite;
        }
        @keyframes tail {
            0% { width: 0; } 30% { width: 100px; } 100% { width: 0; }
        }
        @keyframes shooting {
            0% { transform: translateX(0); } 100% { transform: translateX(300px); }
        }

        /* --- Modal Penjelasan (card style for kids) --- */
        .modal {
            background: linear-gradient(180deg,#07102a,#041024);
            backdrop-filter: blur(6px);
            border-radius: 18px;
            border: 2px solid rgba(255,255,255,0.06);
            padding: 18px;
            box-shadow: 0 24px 60px rgba(3,6,18,0.9);
        }
        .modal h2 { font-size: 2.2rem; }
        .modal p { font-size: 1.05rem; color: #e6eefc; }

        /* --- UI Kontrol (kid-friendly) --- */
        .control-button {
            background: linear-gradient(180deg,#ffffff10,#ffffff08);
            border: 2px solid rgba(255,255,255,0.12);
            transition: background 0.18s, transform 0.18s, box-shadow 0.18s, opacity 0.18s;
            box-shadow: 0 10px 28px rgba(2,6,23,0.6);
            color: white;
            backdrop-filter: blur(4px);
        }
        .control-button:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 12px 30px rgba(0,0,0,0.5);
        }

    /* Make control buttons larger and friendly for kids */
    .control-button { min-width: 52px; min-height: 52px; padding: 0 12px; border-radius: 14px; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; }
        .control-button.small { min-width: 44px; min-height: 44px; border-radius: 12px; }
        @media (max-width: 640px) {
            .control-button { min-width: 64px !important; min-height: 64px !important; font-size: 20px !important; }
            /* extra-controls collapse on small screens by default */
            #extra-controls { display: none; }
            #extra-controls.open { display: flex !important; }
        }

        /* Grouping for essential vs extra controls to improve thumb ergonomics */
    /* Desktop centered control bar with wrap support */
    #ui-controls { transition: transform 300ms cubic-bezier(.2,.9,.2,1), opacity 220ms ease; left: 50%; transform: translateX(-50%); width: min(1100px, 96%); box-sizing: border-box; justify-content: center; display: flex; flex-wrap: wrap; padding: 12px; }
    #ui-controls .ui-essential { display: flex; gap: 12px; align-items: center; justify-content: center; }
    #ui-controls .ui-extra { display: flex; gap: 12px; align-items: center; justify-content: center; }

        /* small helper to visually hide but keep accessible */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

        /* Accessibility styles */
        .planet.selected {
            box-shadow: 0 0 24px 6px rgba(255, 223, 0, 0.9);
            transform: scale(1.6);
            z-index: 30;
        }
        body.high-contrast { background-color: #000 !important; color: #fff; }
        body.high-contrast .planet-label { background: #ffeb3b; color: #000; }
        body.text-size-large { font-size: 18px; }
        body.text-size-small { font-size: 13px; }

        /* Skip link (visually hidden but appears on keyboard focus) */
        .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
        .skip-link:focus { position: fixed; left: 8px; top: 8px; width: auto; height: auto; padding: 8px 12px; background: #fff; color: #000; border-radius: 6px; z-index: 200; text-decoration: none; }

        /* Kid-friendly Tailwind-style focus visuals for SD kelas 6
           - Uses :focus-visible and a keyboard-mode class so mouse clicks don't show outlines
           - Bright, friendly rings with subtle glow and gentle pulse animation */
        :root {
            --kid-focus-from: #ffd54a;
            --kid-focus-to: #60a5fa;
            --kid-focus-ring: rgba(255,203,86,0.95);
            --kid-focus-glow: rgba(96,165,250,0.18);
        }

        @keyframes focus-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,203,86,0.12); }
            50% { box-shadow: 0 0 0 8px rgba(255,203,86,0.06); }
            100% { box-shadow: 0 0 0 0 rgba(255,203,86,0.0); }
        }

        /* Show focus rings for keyboard users (or when body.keyboard-mode is set) */
        :focus-visible, .keyboard-mode :focus {
            outline: none;
            border-radius: 12px;
            background-clip: padding-box;
            box-shadow:
                0 0 0 4px var(--kid-focus-ring),
                0 8px 24px rgba(2,6,23,0.6),
                0 0 18px var(--kid-focus-glow);
            transform: translateY(-2px) scale(1.02);
            animation: focus-pulse 1200ms ease-in-out infinite;
        }

        /* Circular focus for planets / sun / moon */
        .planet:focus-visible, .sun:focus-visible, .moon:focus-visible, .planet.selected {
            outline: none;
            box-shadow:
                0 0 0 6px rgba(255,203,86,0.95),
                0 0 24px rgba(96,165,250,0.18),
                0 6px 30px rgba(0,0,0,0.6);
            border-radius: 50%;
            transform: scale(1.6);
            z-index: 60;
        }

        /* Primary control buttons get a friendlier ring and lift on keyboard focus */
        .control-button:focus-visible {
            outline: none;
            border-radius: 14px;
            box-shadow: 0 0 0 5px rgba(255,214,102,0.95), 0 12px 30px rgba(0,0,0,0.45);
            transform: translateY(-3px) scale(1.03);
        }

        /* Make focus styles more kid-friendly for SD kelas 6:
           - larger visible rings
           - warm-to-cool gradient accent
           - subtle lift and glow only for keyboard users
           These styles use :focus-visible so mouse users are not disturbed.
           Teachers can tweak the CSS variables above to change colors/sizes. */
        .control-button.kid-focus:focus-visible, .quiz-option.kid-focus:focus-visible, button.kid-focus:focus-visible, a.kid-focus:focus-visible {
            box-shadow: 0 0 0 6px var(--kid-focus-ring), 0 14px 38px rgba(2,6,23,0.6), 0 0 28px var(--kid-focus-glow);
            transform: translateY(-4px) scale(1.04);
            transition: transform 160ms ease, box-shadow 160ms ease;
        }

        /* Ensure circular elements keep circular focus highlights */
        .sun.kid-focus:focus-visible, .planet.kid-focus:focus-visible, .moon.kid-focus:focus-visible {
            border-radius: 50%;
            box-shadow: 0 0 0 8px var(--kid-focus-ring), 0 0 36px var(--kid-focus-glow), 0 8px 30px rgba(0,0,0,0.6);
            transform: scale(1.7);
        }

        /* Quiz options: playful, larger ring */
        .quiz-option:focus-visible {
            outline: none;
            box-shadow: 0 0 0 6px rgba(99,102,241,0.16), 0 6px 18px rgba(0,0,0,0.4);
            transform: translateY(-2px) scale(1.02);
        }

        /* Keep skip link visible when focused via keyboard */
        .skip-link:focus-visible { position: fixed; left: 8px; top: 8px; width: auto; height: auto; padding: 8px 12px; background: linear-gradient(90deg,var(--kid-focus-from),#fff); color:#0b1220; border-radius:6px; z-index:200; text-decoration:none; }

        /* Respect reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            :focus-visible, .keyboard-mode :focus, .planet:focus-visible, .control-button:focus-visible, .quiz-option:focus-visible { animation: none; transition: none; transform: none; }
        }

        /* ensure minimum touch target sizes (guideline for kids) */
        .control-button, .quiz-option, .start-decor { min-width: 48px; min-height: 48px; }

        /* keyboard hint badge (shows when Tab navigation used) */
        #keyboard-hint { position: fixed; top: 12px; right: 12px; z-index: 80; background: linear-gradient(90deg,#ffecb3,#ffd54a); color: #0b1220; padding: 8px 12px; border-radius: 999px; box-shadow: 0 8px 30px rgba(2,6,23,0.5); font-weight: 700; display: none; }
        #keyboard-hint.visible { display: block; }

        /* Hide elements until "Mulai Belajar" is pressed */
        .pre-start-hidden { opacity: 0; transform: translateY(10px); pointer-events: none; transition: opacity 420ms cubic-bezier(.2,.9,.2,1), transform 420ms ease; }
        .pre-start-hidden.revealed { opacity: 1; transform: translateY(0); pointer-events: auto; }

        /* Start button decoration */
    .start-decor { width: 420px; height: 120px; background: linear-gradient(135deg, var(--cta-from), var(--cta-to)); border-radius: 999px; border: 6px solid rgba(255,255,255,0.08); position: relative; overflow: hidden; }
    .start-decor::before { content: ''; position: absolute; inset: 0; border-radius: 999px; box-shadow: 0 20px 50px var(--cta-glow); transform: translateY(6px); filter: blur(8px); pointer-events: none; }
    @keyframes glint { 0% { transform: translateX(-120%); opacity: 0 } 50% { transform: translateX(20%); opacity: .7 } 100% { transform: translateX(120%); opacity: 0 } }
    .start-decor::after { content: ''; position: absolute; left: -40%; top: -10%; width: 40%; height: 120%; background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.35), rgba(255,255,255,0)); transform: rotate(-18deg); animation: glint 3.6s ease-in-out infinite; mix-blend-mode: overlay; pointer-events: none; }
    .start-inner { text-shadow: 0 8px 22px rgba(4,6,20,0.45); }
    .start-decor:hover { transform: scale(1.04); }
    @keyframes gentlePulse { 0% { box-shadow: 0 8px 30px rgba(59,130,246,0.12); } 50% { box-shadow: 0 18px 50px rgba(59,130,246,0.18); } 100% { box-shadow: 0 8px 30px rgba(59,130,246,0.12); } }
    .start-decor.pulse { animation: gentlePulse 2.6s ease-in-out infinite; }
        @media (max-width: 640px) { .start-decor { width: 320px; height: 96px; } .start-inner { font-size: 1.8rem; } }

        /* --- Kuis --- */
        .quiz-option {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            transition: background 0.3s;
        }
        .quiz-option:hover {
            background: rgba(74, 144, 226, 0.5);
        }
        .quiz-option.correct {
            background: rgba(46, 204, 113, 0.7);
        }
        .quiz-option.incorrect {
            background: rgba(231, 76, 60, 0.7);
        }
    </style>
</head>
<body class="w-screen h-screen">
    <a href="#solar-system-viewport" class="skip-link" id="skip-to-solar">Lewati ke tata surya</a>
    <!-- Kid-friendly header (small) -->
    <header id="site-header" class="fixed top-4 left-4 z-40 flex items-center gap-3 pre-start-hidden" aria-hidden="true">
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-300 to-orange-400 flex items-center justify-center shadow-lg">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="6" fill="#FFD54A"/></svg>
        </div>
        <div class="text-left text-white">
            <div class="text-sm font-bold">Jelajah Antariksa</div>
            <div class="text-xs text-white/80">Ayo belajar sambil bermain!</div>
        </div>
        <button id="help-open" class="ml-4 control-button px-3 py-2 rounded-full text-sm bg-white text-black font-semibold focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-300 focus-visible:scale-105" title="Buka panduan">Bantuan</button>
    </header>

    <!-- Keyboard navigation hint -->
    <div id="keyboard-hint" aria-hidden="true">Gunakan Tab untuk navigasi</div>

    <!-- Onboarding hint for first-time users -->
    <div id="onboard" style="display:none;" class="fixed inset-0 z-50 flex items-center justify-center p-6" role="dialog" aria-live="polite" aria-label="Panduan multi langkah">
        <div class="w-full max-w-2xl bg-gradient-to-b from-slate-900/95 to-indigo-900/95 text-white rounded-3xl p-6 shadow-2xl border-2 border-white/6">
            <div id="onboard-steps" class="flex flex-col gap-4">
                <!-- Step 1 -->
                <div class="onboard-step" data-step="1">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-yellow-300 to-orange-400 flex items-center justify-center text-black font-bold">1</div>
                        <div>
                            <h4 class="text-2xl font-bold">Kenali Planet</h4>
                            <p class="text-sm text-white/80">Sentuh planet untuk melihat informasi dan mendengarkan cerita. Cobalah mulai dari Bumi!</p>
                        </div>
                    </div>
                </div>
                <!-- Step 2 -->
                <div class="onboard-step hidden" data-step="2">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-sky-400 to-indigo-500 flex items-center justify-center text-white font-bold">2</div>
                        <div>
                            <h4 class="text-2xl font-bold">Perbesar & Jelajah</h4>
                            <p class="text-sm text-white/80">Gunakan tombol + / - untuk memperbesar atau seret layar untuk berpindah. Tombol tambahan ada di bawah.</p>
                        </div>
                    </div>
                </div>
                <!-- Step 3 -->
                <div class="onboard-step hidden" data-step="3">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-emerald-400 to-green-500 flex items-center justify-center text-white font-bold">3</div>
                        <div>
                            <h4 class="text-2xl font-bold">Ayo Bermain</h4>
                            <p class="text-sm text-white/80">Buka kuis seru atau mulai tur otomatis untuk melihat planet satu-persatu.</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between mt-4">
                    <div>
                        <button id="onboard-prev" class="control-button px-4 py-2 rounded-full bg-gray-700 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300">Kembali</button>
                        <button id="onboard-next" class="control-button px-4 py-2 rounded-full bg-indigo-500 text-white ml-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300">Selanjutnya</button>
                    </div>
                    <div>
                        <button id="onboard-close" class="control-button px-4 py-2 rounded-full bg-yellow-300 text-black font-bold focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-300">Mulai</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. Animasi Layar Pembuka -->
    <div id="splash-screen">
        <div class="logo-container">
            <div class="logo-sun"></div>
            <div class="logo-orbit">
                <div class="logo-planet logo-planet1"></div>
            </div>
            <div class="logo-orbit">
                <div class="logo-planet logo-planet2"></div>
            </div>
        </div>
        <h1 id="splash-title">JELAJAH ANTARIKSA</h1>
    </div>

    <!-- 2. Tombol Mulai Belajar -->
    <div id="start-container" class="fixed inset-0 flex justify-center items-center pointer-events-auto">
        <button id="start-button" class="start-decor relative inline-flex items-center justify-center text-white font-extrabold rounded-full shadow-2xl focus:outline-none focus-visible:ring-6 focus-visible:ring-indigo-300 focus-visible:scale-105">
            <span class="start-inner px-10 py-6 text-3xl select-none">Mulai Belajar</span>
        </button>
    </div>

    <!-- Konten Utama: Tata Surya dan UI -->
    <div id="solar-system-viewport">
        <canvas id="stars-canvas"></canvas>
        
        <!-- 3 & 7. Tata Surya dengan Penghias -->
        <div id="solar-system-container">
            <!-- Matahari -->
            <div class="sun focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="matahari" tabindex="0" role="button" aria-label="Matahari"></div>
            <div class="planet-label" style="top: -70px; left: -25px;">Matahari</div>

            <!-- Planet-planet -->
            <div class="orbit mercury-orbit">
                <div class="planet mercury focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="merkurius" tabindex="0" role="button" aria-label="Merkurius"><img src="item/Merkurius.png" alt="Merkurius"></div>
                <div class="planet-label">Merkurius</div>
            </div>
            <div class="orbit venus-orbit">
                <div class="planet venus focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="venus" tabindex="0" role="button" aria-label="Venus"><img src="item/Venus.jpg" alt="Venus"></div>
                <div class="planet-label">Venus</div>
            </div>
            <div class="orbit earth-orbit">
                <div class="earth-wrapper">
                    <div class="planet earth focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="bumi" tabindex="0" role="button" aria-label="Bumi"><img src="item/Bumi.jpg" alt="Bumi"></div>
                    <div class="moon-orbit"><div class="moon" data-planet="bulan" title="Bulan"></div></div>
                </div>
                <div class="planet-label">Bumi</div>
            </div>
            <div class="orbit mars-orbit">
                <div class="planet mars focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="mars" tabindex="0" role="button" aria-label="Mars"><img src="item/Mars.jpg" alt="Mars"></div>
                <div class="planet-label">Mars</div>
            </div>
            <div class="orbit jupiter-orbit">
                <div class="planet jupiter focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="jupiter" tabindex="0" role="button" aria-label="Jupiter"><img src="item/Jupiter.jpg" alt="Jupiter"></div>
                <div class="planet-label">Jupiter</div>
            </div>
            <div class="orbit saturn-orbit">
                <div class="planet saturn focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="saturnus" tabindex="0" role="button" aria-label="Saturnus"></div>
                <div class="planet-label">Saturnus</div>
            </div>
            <div class="orbit uranus-orbit">
                <div class="planet uranus focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="uranus" tabindex="0" role="button" aria-label="Uranus"><img src="item/Uranus.jpg" alt="Uranus"></div>
                <div class="planet-label">Uranus</div>
            </div>
            <div class="orbit neptune-orbit">
                <div class="planet neptune focus:outline-none focus-visible:ring-6 focus-visible:ring-yellow-400 focus-visible:scale-150" data-planet="neptunus" tabindex="0" role="button" aria-label="Neptunus"><img src="item/Neptunus.jpg" alt="Neptunus"></div>
                <div class="planet-label">Neptunus</div>
            </div>
        </div>
    </div>
    
    <!-- 5 & 6. Fitur Tambahan (UI Kontrol) -->
    <div id="ui-controls" class="fixed bottom-5 left-1/2 -translate-x-1/2 flex items-center gap-3 p-4 md:p-3 rounded-full z-20 pre-start-hidden" style="background: linear-gradient(180deg, rgba(6,8,20,0.8), rgba(4,6,14,0.6)); backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.03);">
        <div class="ui-essential">
            <button id="zoom-in" class="control-button text-3xl shadow-md bg-gradient-to-br from-indigo-400 to-sky-500 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300" aria-label="Perbesar">+</button>
            <button id="zoom-out" class="control-button text-3xl shadow-md bg-gradient-to-br from-indigo-400 to-sky-500 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300" aria-label="Perkecil">-</button>
            <button id="reset-view" class="control-button flex justify-center items-center shadow bg-white/5 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300" aria-label="Atur ulang tampilan">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v6h6"/><path d="M21 12A9 9 0 0 0 6 5.3L3 8"/><path d="M21 22v-6h-6"/><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"/></svg>
            </button>
            <button id="toggle-orbit" class="control-button flex justify-center items-center bg-yellow-400 text-black font-bold focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-300" aria-pressed="false">
                <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
            </button>
            <button id="quiz-button" class="control-button px-4 py-2 rounded-full text-lg font-extrabold bg-amber-400 text-black shadow-md hover:scale-105 focus:outline-none focus-visible:ring-4 focus-visible:ring-amber-300">Kuis Seru</button>
            <button id="mode-toggle" class="control-button px-4 py-2 rounded-full text-base font-semibold bg-green-400 text-black focus:outline-none focus-visible:ring-4 focus-visible:ring-emerald-300">Mode: Putar</button>
        </div>

        <div id="extra-controls" class="ui-extra">
            <button id="fullscreen-toggle" title="Fullscreen (F)" class="control-button px-3 py-2 rounded-full text-base font-semibold bg-gray-800 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300">â›¶</button>
            <div class="flex items-center gap-2 px-2">
                <label for="orbit-speed" class="text-xs text-white/90">Kecepatan Orbit</label>
                <input id="orbit-speed" type="range" min="0.2" max="3" step="0.1" value="1" class="w-36">
            </div>
            <button id="tour-toggle" class="control-button px-4 py-2 rounded-full text-base font-semibold bg-indigo-500 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300">Mulai Tur</button>
            <div class="flex items-center gap-2">
                <button id="contrast-toggle" class="control-button px-3 h-12 rounded-full text-sm font-semibold bg-yellow-400 text-black focus:outline-none focus-visible:ring-4 focus-visible:ring-yellow-300">Kontras</button>
                <button id="text-decrease" class="control-button px-3 h-12 rounded-full text-sm font-semibold bg-gray-700 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300">A-</button>
                <button id="text-increase" class="control-button px-3 h-12 rounded-full text-sm font-semibold bg-gray-700 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300">A+</button>
            </div>
        </div>

    <button id="more-toggle" class="control-button md:hidden px-3 py-2 rounded-full bg-rose-500 text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-rose-300" aria-expanded="false" aria-controls="extra-controls">More</button>
        <!-- Live region for announcements for screen reader and TTS fallback -->
        <div id="announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    </div>
    <!-- Mobile controls toggle (visible on small screens) -->
    <button id="mobile-controls-toggle" class="fixed bottom-5 right-5 z-30 md:hidden control-button px-4 py-3 rounded-full bg-rose-500 text-white shadow-lg pre-start-hidden focus:outline-none focus-visible:ring-4 focus-visible:ring-rose-300">Menu</button>

    <style>
        /* Mobile bottom-sheet style for controls */
        @media (max-width: 640px) {
            /* full-width bottom-sheet on small screens */
            #ui-controls { position: fixed; left: 0; right: 0; bottom: 0; transform: translateY(100%); width: 100%; max-width: 100%; border-radius: 16px 16px 0 0; padding: 12px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
            #ui-controls.open { transform: translateY(0%); }
            #mobile-controls-toggle { display: block; }
            /* extra-controls hidden by default, when opened they occupy full row */
            #extra-controls { display: none; width: 100%; justify-content: center; }
            #extra-controls.open { display: flex !important; }
            #ui-controls .ui-essential { width: 100%; justify-content: center; gap: 12px; }
        }
        @media (min-width: 641px) {
            #mobile-controls-toggle { display: none; }
        }
    </style>
     <div id="fact-button" class="fixed top-6 right-6 z-20 pre-start-hidden">
        <button class="control-button px-4 py-3 rounded-full text-lg font-extrabold bg-pink-500 text-white shadow-lg">Fakta Menarik!</button>
    </div>


    <!-- 4. Modal Penjelasan Planet (dengan Suara) -->
    <div id="planet-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-30 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description">
        <div class="modal w-full max-w-2xl rounded-2xl shadow-lg p-8 relative transform scale-95 transition-transform duration-300">
            <button id="modal-close" class="absolute top-4 right-4 text-white hover:text-gray-300 control-button small focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300" aria-label="Tutup informasi">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h2 id="modal-title" class="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 to-orange-400"></h2>
            <p id="modal-description" class="text-lg leading-relaxed"></p>
            <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <h4 class="text-sm text-gray-400">Jarak dari Matahari</h4>
                    <p id="modal-distance" class="text-xl font-semibold"></p>
                </div>
                <div>
                    <h4 class="text-sm text-gray-400">Diameter</h4>
                    <p id="modal-diameter" class="text-xl font-semibold"></p>
                </div>
                <div>
                    <h4 class="text-sm text-gray-400">Lama 1 Hari</h4>
                    <p id="modal-day" class="text-xl font-semibold"></p>
                </div>
                 <div>
                    <h4 class="text-sm text-gray-400">Lama 1 Tahun</h4>
                    <p id="modal-year" class="text-xl font-semibold"></p>
                </div>
            </div>
            <button id="speak-button" class="mt-6 w-12 h-12 bg-blue-500 rounded-full flex justify-center items-center mx-auto hover:bg-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-white"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </button>
        </div>
    </div>
    
    <!-- Kuis Modal -->
    <div id="quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-40 hidden">
        <div class="modal w-full max-w-lg rounded-2xl shadow-lg p-8 relative">
            <button id="quiz-close" class="absolute top-4 right-4 text-white hover:text-gray-300 focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300">
                 <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div id="quiz-content">
                <h2 class="text-2xl font-bold mb-4 text-center">Kuis Tata Surya!</h2>
                <p id="quiz-question" class="text-lg mb-6 text-center"></p>
                <div id="quiz-options" class="grid grid-cols-2 gap-4"></div>
                <div id="quiz-feedback" class="mt-4 text-center font-bold"></div>
            </div>
            <div id="quiz-result" class="hidden text-center">
                 <h2 class="text-3xl font-bold mb-4 text-yellow-300">Hasil Kuis</h2>
                 <p class="text-xl mb-2">Kamu berhasil menjawab</p>
                 <p class="text-5xl font-bold mb-4"><span id="quiz-score">0</span> / <span id="quiz-total">0</span></p>
                <button id="quiz-retry" class="bg-blue-500 hover:bg-blue-400 text-white font-bold py-2 px-6 rounded-full text-lg focus:outline-none focus-visible:ring-4 focus-visible:ring-sky-300">Coba Lagi</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Database Planet ---
    const planetData = {
        matahari: {
            name: 'Matahari',
            description: 'Aku adalah Matahari, pusat tata surya. Aku adalah bintang raksasa yang sangat panas dan cahayaku menerangi semua planet. Tanpa aku, tidak akan ada kehidupan di Bumi, lho!',
            distance: '0',
            diameter: '1.4 juta km',
            day: '27 hari Bumi',
            year: '-'
        },
        merkurius: {
            name: 'Merkurius',
            description: 'Hai, aku Merkurius! Aku adalah planet terkecil dan paling dekat dengan Matahari. Di sini sangat panas di siang hari, dan sangat dingin di malam hari. Aku tidak punya bulan.',
            distance: '58 juta km',
            diameter: '4.879 km',
            day: '59 hari Bumi',
            year: '88 hari Bumi'
        },
        venus: {
            name: 'Venus',
            description: 'Aku Venus, si bintang fajar atau bintang senja. Aku planet terpanas di tata surya karena awan tebalku memerangkap panas. Aku berputar ke arah yang berlawanan dari planet lain!',
            distance: '108 juta km',
            diameter: '12.104 km',
            day: '243 hari Bumi',
            year: '225 hari Bumi'
        },
        bumi: {
            name: 'Bumi',
            description: 'Inilah aku, Bumi, rumah kita semua! Aku satu-satunya planet yang diketahui memiliki kehidupan dan air. Aku punya satu teman setia yang selalu mengikutiku, yaitu Bulan.',
            distance: '150 juta km',
            diameter: '12.742 km',
            day: '24 jam',
            year: '365.25 hari'
        },
        bulan: {
            name: 'Bulan',
            description: 'Bulan adalah satelit alami Bumi. Ia mengelilingi Bumi dan mempengaruhi pasang surut laut. Bulan tidak memiliki atmosfer yang signifikan.',
            distance: '384.400 km dari Bumi',
            diameter: '3.474 km',
            day: '27.3 hari (sinkronisasi rotasi)',
            year: '-'
        },
        mars: {
            name: 'Mars',
            description: 'Aku Mars, si Planet Merah. Warna merahku berasal dari besi berkarat di permukaanku. Para ilmuwan sangat penasaran denganku dan sering mengirim robot untuk memeriksaku!',
            distance: '228 juta km',
            diameter: '6.779 km',
            day: '24.6 jam',
            year: '687 hari Bumi'
        },
        jupiter: {
            name: 'Jupiter',
            description: 'Aku Jupiter, planet terbesar di tata surya! Aku sangat besar sampai-sampai semua planet lain bisa muat di dalamku. Aku punya badai raksasa yang disebut Bintik Merah Raksasa.',
            distance: '778 juta km',
            diameter: '139.820 km',
            day: '9.9 jam',
            year: '11.9 tahun Bumi'
        },
        saturnus: {
            name: 'Saturnus',
            description: 'Aku Saturnus, planet yang terkenal dengan cincinku yang indah. Cincinku terbuat dari miliaran bongkahan es dan batu. Aku terlihat cantik, kan?',
            distance: '1.4 miliar km',
            diameter: '116.460 km',
            day: '10.7 jam',
            year: '29.5 tahun Bumi'
        },
        uranus: {
            name: 'Uranus',
            description: 'Aku Uranus, si raksasa es. Aku unik karena aku berputar miring seperti menggelinding. Jadi, kutubku kadang-kadang menghadap langsung ke Matahari.',
            distance: '2.9 miliar km',
            diameter: '50.724 km',
            day: '17.2 jam',
            year: '84 tahun Bumi'
        },
        neptunus: {
            name: 'Neptunus',
            description: 'Aku Neptunus, planet terjauh dari Matahari. Di sini sangat dingin dan berangin. Angin di sini adalah yang tercepat di seluruh tata surya!',
            distance: '4.5 miliar km',
            diameter: '49.244 km',
            day: '16.1 jam',
            year: '164.8 tahun Bumi'
        }
    };

    const quizQuestions = [
        { question: "Planet manakah yang paling dekat dengan Matahari?", options: ["Venus", "Merkurius", "Bumi", "Mars"], answer: "Merkurius" },
        { question: "Planet apa yang dikenal sebagai 'Planet Merah'?", options: ["Jupiter", "Saturnus", "Mars", "Bumi"], answer: "Mars" },
        { question: "Planet terbesar di tata surya adalah...", options: ["Jupiter", "Bumi", "Neptunus", "Saturnus"], answer: "Jupiter" },
        { question: "Planet manakah yang memiliki cincin yang indah?", options: ["Uranus", "Mars", "Jupiter", "Saturnus"], answer: "Saturnus" },
        { question: "Rumah kita, tempat tinggal semua makhluk hidup, adalah planet...", options: ["Venus", "Bumi", "Mars", "Merkurius"], answer: "Bumi" },
        { question: "Planet manakah yang paling panas?", options: ["Merkurius", "Venus", "Bumi", "Matahari"], answer: "Venus"}
    ];

    const randomFacts = [
        "Di Jupiter dan Saturnus, hujan turun dalam bentuk berlian!",
        "Satu hari di Venus lebih lama dari satu tahunnya.",
        "Matahari sangat besar, sekitar 1 juta Bumi bisa muat di dalamnya.",
        "Jejak kaki astronot di Bulan akan tetap ada di sana selamanya karena tidak ada angin.",
        "Ada lebih banyak bintang di alam semesta daripada butiran pasir di semua pantai di Bumi."
    ];

    // --- Variabel State ---
    let currentZoom = 0.5;
    let isPanning = false;
    let startPan = { x: 0, y: 0 };
    let panOffset = { x: 0, y: 0 };
    let isOrbiting = false;

    // Accessibility helpers: focus trap (simple)
    let lastFocusedElement = null;
    function trapFocus(container) {
        if (!container) return;
        const focusable = container.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])');
        if (!focusable.length) return;
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        function keyHandler(e) {
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === first) {
                    e.preventDefault(); last.focus();
                } else if (!e.shiftKey && document.activeElement === last) {
                    e.preventDefault(); first.focus();
                }
            }
            if (e.key === 'Escape') {
                if (container.id === 'planet-modal') hidePlanetInfo();
                if (container.id === 'closeup-panel') hideCloseup();
            }
        }
        container._keyHandler = keyHandler;
        document.addEventListener('keydown', keyHandler);
        // remember last focused element and focus the first element in the container
        lastFocusedElement = document.activeElement;
        setTimeout(() => first.focus(), 50);
    }
    function releaseFocus(container) {
        if (!container) return;
        if (container._keyHandler) {
            document.removeEventListener('keydown', container._keyHandler);
            delete container._keyHandler;
        }
        if (lastFocusedElement) { try { lastFocusedElement.focus(); } catch (e) {} lastFocusedElement = null; }
    }

    // --- Elemen DOM ---
    const splashScreen = document.getElementById('splash-screen');
    const startContainer = document.getElementById('start-container');
    const startButton = document.getElementById('start-button');
    const solarSystemViewport = document.getElementById('solar-system-viewport');
    const solarSystemContainer = document.getElementById('solar-system-container');
    const uiControls = document.getElementById('ui-controls');
    const planetModal = document.getElementById('planet-modal');
    const modalClose = document.getElementById('modal-close');
    const quizModal = document.getElementById('quiz-modal');
    const quizClose = document.getElementById('quiz-close');
    const quizButton = document.getElementById('quiz-button');
    const factButton = document.getElementById('fact-button');
    
    // --- Inisialisasi ---
    function init() {
        setupSplashScreen();
        setupEventListeners();
        createStarfield();
        createShootingStars();
        updateTransform();
        // default mode = spin
        document.getElementById('solar-system-viewport').classList.add('mode-spin');
        document.querySelectorAll('.planet').forEach(p => p.classList.add('spin'));
        // store base orbit durations so orbit-speed control can scale them
        document.querySelectorAll('.orbit').forEach(o => {
            const style = getComputedStyle(o).animationDuration || '1s';
            const seconds = parseFloat(style.replace('s','')) || 1;
            o.setAttribute('data-base-duration', seconds);
        });
    }

    // --- Fungsi Pengaturan Awal ---
    function setupSplashScreen() {
        setTimeout(() => {
            splashScreen.style.opacity = '0';
            startContainer.style.opacity = '1';
            startContainer.style.visibility = 'visible';
            setTimeout(() => splashScreen.style.display = 'none', 1000);
        }, 4000);
    }
    
    function setupEventListeners() {
        startButton.addEventListener('click', startExperience);
        
        // Kontrol Zoom dan Pan
        document.getElementById('zoom-in').addEventListener('click', () => zoom(0.1));
        document.getElementById('zoom-out').addEventListener('click', () => zoom(-0.1));
        document.getElementById('reset-view').addEventListener('click', resetView);
        solarSystemViewport.addEventListener('wheel', (e) => {
            e.preventDefault();
            zoom(e.deltaY * -0.001);
        });
        solarSystemViewport.addEventListener('mousedown', (e) => {
            isPanning = true;
            solarSystemViewport.style.cursor = 'grabbing';
            startPan = { x: e.clientX - panOffset.x, y: e.clientY - panOffset.y };
        });
        solarSystemViewport.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            panOffset.x = e.clientX - startPan.x;
            panOffset.y = e.clientY - startPan.y;
            updateTransform();
        });
        window.addEventListener('mouseup', () => {
             isPanning = false;
             solarSystemViewport.style.cursor = 'grab';
        });

        // Interaksi Planet (termasuk Bulan)
        document.querySelectorAll('.planet, .sun, .moon').forEach(el => {
            el.addEventListener('click', (ev) => {
                ev.stopPropagation();
                showPlanetInfo(el.dataset.planet);
            });
        });
        modalClose.addEventListener('click', hidePlanetInfo);
        document.getElementById('speak-button').addEventListener('click', speakModalDescription);

        // Kontrol Orbit
        document.getElementById('toggle-orbit').addEventListener('click', toggleOrbit);

        // Kuis
        quizButton.addEventListener('click', startQuiz);
        quizClose.addEventListener('click', () => quizModal.classList.add('hidden'));
        document.getElementById('quiz-retry').addEventListener('click', startQuiz);

        // Fakta Menarik
        factButton.addEventListener('click', showRandomFact);
        // Mode toggle (Putar / Statis)
        const modeBtn = document.getElementById('mode-toggle');
        const fullscreenBtn = document.getElementById('fullscreen-toggle');
        if (modeBtn) modeBtn.addEventListener('click', toggleMode);
        if (fullscreenBtn) fullscreenBtn.addEventListener('click', toggleFullscreen);

        // Double-click on a planet to zoom to it (also works for moon)
        document.querySelectorAll('.planet, .moon, .sun').forEach(el => {
            el.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                const key = el.dataset.planet;
                if (key) zoomToPlanet(el);
            });
        });

        // Keyboard fullscreen toggle (F)
        window.addEventListener('keydown', (e) => { if (e.key === 'f' || e.key === 'F') toggleFullscreen(); });
        // Touch handlers: pinch-to-zoom and two-finger pan
        let lastTouchDistance = null;
        let lastTouchCenter = null;
        function getTouchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.hypot(dx, dy);
        }
        function getTouchCenter(touches) {
            return { x: (touches[0].clientX + touches[1].clientX)/2, y: (touches[0].clientY + touches[1].clientY)/2 };
        }
        solarSystemViewport.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                lastTouchDistance = getTouchDistance(e.touches);
                lastTouchCenter = getTouchCenter(e.touches);
            } else if (e.touches.length === 1) {
                // single finger -> start panning
                isPanning = true;
                startPan = { x: e.touches[0].clientX - panOffset.x, y: e.touches[0].clientY - panOffset.y };
            }
        }, { passive: false });
        solarSystemViewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const dist = getTouchDistance(e.touches);
                const center = getTouchCenter(e.touches);
                const delta = dist / lastTouchDistance;
                // update zoom with a scale factor
                const newZoom = Math.max(0.1, Math.min(3, currentZoom * delta));
                // compute pan so center stays focused
                const rect = solarSystemContainer.getBoundingClientRect();
                const screenCenter = { x: window.innerWidth/2, y: window.innerHeight/2 };
                // adjust panOffset so the touch center remains in place after zoom
                const offsetX = (center.x - screenCenter.x) * (1 - newZoom/currentZoom);
                const offsetY = (center.y - screenCenter.y) * (1 - newZoom/currentZoom);
                currentZoom = newZoom;
                panOffset.x += offsetX;
                panOffset.y += offsetY;
                updateTransform();
                lastTouchDistance = dist;
                lastTouchCenter = center;
            } else if (e.touches.length === 1 && isPanning) {
                panOffset.x = e.touches[0].clientX - startPan.x;
                panOffset.y = e.touches[0].clientY - startPan.y;
                updateTransform();
            }
        }, { passive: false });
        solarSystemViewport.addEventListener('touchend', (e) => {
            if (e.touches.length < 2) {
                lastTouchDistance = null;
                lastTouchCenter = null;
            }
            if (e.touches.length === 0) {
                isPanning = false;
            }
        });
        // Closeup panel close
        const closeBtn = document.getElementById('closeup-close');
        if (closeBtn) closeBtn.addEventListener('click', hideCloseup);
        // Orbit speed control
        const orbitSpeed = document.getElementById('orbit-speed');
        if (orbitSpeed) {
            orbitSpeed.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value) || 1;
                // We'll scale base durations by 1/val
                document.querySelectorAll('.orbit').forEach(o => {
                    const base = parseFloat(o.getAttribute('data-base-duration')) || getComputedStyle(o).animationDuration.replace('s','') || 1;
                    const newDur = (base / val).toFixed(2) + 's';
                    o.style.animationDuration = newDur;
                });
            });
        }
        // Auto-tour toggle
        const tourBtn = document.getElementById('tour-toggle');
        if (tourBtn) tourBtn.addEventListener('click', () => {
            if (tourRunning) stopTour(); else startTour();
        });
        // Accessibility: keyboard navigation
        const focusablePlanets = Array.from(document.querySelectorAll('.planet, .sun, .moon')).filter(el => el.tabIndex >= 0);
        let focusedIndex = 0;
        focusablePlanets.forEach((el, idx) => {
            el.addEventListener('focus', () => { focusedIndex = idx; el.classList.add('selected'); });
            el.addEventListener('blur', () => { el.classList.remove('selected'); });
            el.addEventListener('keydown', (ev) => {
                if (ev.key === 'Enter') { ev.preventDefault(); showPlanetInfo(el.dataset.planet); }
            });
        });
        window.addEventListener('keydown', (ev) => {
            if (ev.key === 'ArrowRight') { focusedIndex = Math.min(focusablePlanets.length-1, focusedIndex+1); focusablePlanets[focusedIndex].focus(); }
            if (ev.key === 'ArrowLeft') { focusedIndex = Math.max(0, focusedIndex-1); focusablePlanets[focusedIndex].focus(); }
            if (ev.key === 'Enter') { const el = focusablePlanets[focusedIndex]; if (el) showPlanetInfo(el.dataset.planet); }
        });

        // Contrast and text size controls
        const contrastBtn = document.getElementById('contrast-toggle');
        const textInc = document.getElementById('text-increase');
        const textDec = document.getElementById('text-decrease');
        if (contrastBtn) contrastBtn.addEventListener('click', () => document.body.classList.toggle('high-contrast'));
        if (textInc) textInc.addEventListener('click', () => { document.body.classList.remove('text-size-small'); document.body.classList.add('text-size-large'); });
        if (textDec) textDec.addEventListener('click', () => { document.body.classList.remove('text-size-large'); document.body.classList.add('text-size-small'); });

        // Mobile controls toggle
        const mobileToggle = document.getElementById('mobile-controls-toggle');
        const uiControlsEl = document.getElementById('ui-controls');
        if (mobileToggle && uiControlsEl) {
            mobileToggle.addEventListener('click', () => {
                uiControlsEl.classList.toggle('open');
                // change label
                mobileToggle.textContent = uiControlsEl.classList.contains('open') ? 'Tutup' : 'Menu';
            });
        }

        // "More" toggle to reveal extra controls on small screens
        const moreToggle = document.getElementById('more-toggle');
        const extraControls = document.getElementById('extra-controls');
        const announcer = document.getElementById('announcer');
        if (moreToggle && extraControls) {
            moreToggle.addEventListener('click', () => {
                const willOpen = !extraControls.classList.contains('open');
                extraControls.classList.toggle('open');
                moreToggle.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
                moreToggle.textContent = willOpen ? 'Tutup' : 'More';
                // announce change for SR and TTS fallback
                if (announcer) announcer.textContent = willOpen ? 'Kontrol tambahan terbuka' : 'Kontrol tambahan tertutup';
            });
        }

        // Onboarding: open via Help button and step navigation
        const onboard = document.getElementById('onboard');
        const helpOpen = document.getElementById('help-open');
        const onboardPrev = document.getElementById('onboard-prev');
        const onboardNext = document.getElementById('onboard-next');
        const onboardClose = document.getElementById('onboard-close');
        let onboardStep = 1;
        const maxOnboard = 3;
        function showOnboard(step = 1) {
            // if user previously chose to skip onboarding, don't auto-open; Help button will still open
            onboard.style.display = 'flex';
            onboard.querySelectorAll('.onboard-step').forEach(el => el.classList.add('hidden'));
            const target = onboard.querySelector(`.onboard-step[data-step="${step}"]`);
            if (target) target.classList.remove('hidden');
            trapFocus(onboard);
        }
        function hideOnboard() {
            onboard.style.display = 'none';
            releaseFocus(onboard);
        }
        if (helpOpen) helpOpen.addEventListener('click', () => { showOnboard(1); });
        if (onboardPrev) onboardPrev.addEventListener('click', () => { onboardStep = Math.max(1, onboardStep-1); showOnboard(onboardStep); });
        if (onboardNext) onboardNext.addEventListener('click', () => { onboardStep = Math.min(maxOnboard, onboardStep+1); showOnboard(onboardStep); });
    if (onboardClose) onboardClose.addEventListener('click', () => { hideOnboard(); localStorage.setItem('onboardSeen', '1'); });

        // keyboard navigation hint: show when user presses Tab
        let keyboardHintTimer = null;
        const keyboardHint = document.getElementById('keyboard-hint');
        function showKeyboardHint() {
            if (!keyboardHint) return;
            document.body.classList.add('keyboard-mode');
            keyboardHint.classList.add('visible');
            if (keyboardHintTimer) clearTimeout(keyboardHintTimer);
            keyboardHintTimer = setTimeout(() => { keyboardHint.classList.remove('visible'); }, 4000);
        }
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                showKeyboardHint();
            }
        });
    }

    // --- Fungsi Utama ---
    function startExperience() {
        // Hide splash/start visuals, reveal the solar system and controls in a staged way
        // small exit animation for start button
        const startBtn = document.getElementById('start-button');
        startBtn.style.transform = 'scale(0.9) translateY(20px)';
        startBtn.style.opacity = '0';
        setTimeout(() => {
            // hide the start container so it doesn't block interactions
            startContainer.style.display = 'none';
            // reveal main viewport
            solarSystemViewport.style.opacity = '1';
            solarSystemViewport.style.visibility = 'visible';
            // reveal header, UI controls, mobile toggle and fact button with small stagger
            document.querySelectorAll('.pre-start-hidden').forEach((el, idx) => {
                setTimeout(() => el.classList.add('revealed'), idx * 90);
            });
            // Do not auto-show onboarding if user already saw it; allow Help button to open it
            const onboardSeen = localStorage.getItem('onboardSeen');
            if (!onboardSeen) {
                // we intentionally do not auto-open; teachers can press Bantuan to show the onboarding
            }

            // start orbit and music
            toggleOrbit(); // Auto play orbit
            startBackgroundMusic();
        }, 300);
    }

    // --- Background Music Playlist ---
    const audioPlayer = document.createElement('audio');
    audioPlayer.id = 'bg-audio';
    audioPlayer.style.display = 'none';
    // list in order
    const playlist = [
        'background_music/Cosmic Voyage.mp3',
        'background_music/Cosmic VoyageL.mp3'
    ];
    let playlistIndex = 0;
    audioPlayer.src = playlist[playlistIndex];
    audioPlayer.loop = false;
    document.body.appendChild(audioPlayer);

    function playNextTrack() {
        playlistIndex++;
        if (playlistIndex >= playlist.length) {
            // stop after last track; or uncomment to loop
            // playlistIndex = 0;
            return;
        }
        audioPlayer.src = playlist[playlistIndex];
        audioPlayer.play().catch(err => {
            // Autoplay may be blocked until user interacts â€” we already have a click to startExperience
            console.warn('Audio play failed:', err);
        });
    }

    audioPlayer.addEventListener('ended', playNextTrack);

    function startBackgroundMusic() {
        // Reset to first track and play
        playlistIndex = 0;
        audioPlayer.src = playlist[playlistIndex];
        audioPlayer.currentTime = 0;
        audioPlayer.volume = 0.5;
        audioPlayer.play().catch(err => console.warn('Audio play error:', err));
    }

    function showPlanetInfo(planetId) {
        const data = planetData[planetId];
        if (!data) return;

        document.getElementById('modal-title').textContent = data.name;
        document.getElementById('modal-description').textContent = data.description;
        document.getElementById('modal-distance').textContent = data.distance;
        document.getElementById('modal-diameter').textContent = data.diameter;
        document.getElementById('modal-day').textContent = data.day;
        document.getElementById('modal-year').textContent = data.year;
        
        // show modal and trap focus
        planetModal.classList.remove('hidden');
        planetModal.setAttribute('aria-hidden', 'false');
        setTimeout(() => planetModal.querySelector('.modal').classList.add('scale-100'), 10);
        // trap focus inside modal
        setTimeout(() => trapFocus(planetModal), 80);
        speakModalDescription();
    }

    function hidePlanetInfo() {
        window.speechSynthesis.cancel();
        planetModal.querySelector('.modal').classList.remove('scale-100');
        setTimeout(() => { planetModal.classList.add('hidden'); planetModal.setAttribute('aria-hidden', 'true'); releaseFocus(planetModal); }, 300);
    }
    
    // Fungsi Suara
    function speak(text) {
        window.speechSynthesis.cancel(); // Hentikan suara sebelumnya
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'id-ID';
        utterance.rate = 0.9;
        
        // Coba cari suara anak-anak jika ada (tergantung browser)
        let voices = window.speechSynthesis.getVoices();
        let femaleVoice = voices.find(voice => voice.lang === 'id-ID' && voice.name.includes('Female'));
        if (femaleVoice) {
            utterance.voice = femaleVoice;
        }

        window.speechSynthesis.speak(utterance);
        // Also update the announcer live region for devices without speech or when TTS blocked
        const announcer = document.getElementById('announcer');
        if (announcer) {
            announcer.textContent = text;
        }
    }
    
    // Pastikan suara dimuat sebelum digunakan
    window.speechSynthesis.onvoiceschanged = () => {
        // console.log("Voices loaded");
    };

    function speakModalDescription() {
        const title = document.getElementById('modal-title').textContent;
        const description = document.getElementById('modal-description').textContent;
        speak(`${title}. ${description}`);
    }

    function showRandomFact() {
        const randomFact = randomFacts[Math.floor(Math.random() * randomFacts.length)];
        // Menggunakan modal planet untuk menampilkan fakta
        document.getElementById('modal-title').textContent = "Fakta Menarik Antariksa";
        document.getElementById('modal-description').textContent = randomFact;
        document.querySelectorAll('.modal .grid div').forEach(el => el.style.display = 'none');
        document.getElementById('speak-button').style.display = 'block';

        planetModal.classList.remove('hidden');
        setTimeout(() => planetModal.querySelector('.modal').classList.add('scale-100'), 10);
        
        speak(randomFact);
    }

    // Fungsi Kontrol Tampilan
    function updateTransform() {
        solarSystemContainer.style.transform = `translate(${panOffset.x}px, ${panOffset.y}px) scale(${currentZoom})`;
    }

    function zoom(amount) {
        currentZoom = Math.max(0.1, Math.min(3, currentZoom + amount));
        updateTransform();
    }

    function resetView() {
        currentZoom = 0.5;
        panOffset = { x: 0, y: 0 };
        updateTransform();
    }

    function toggleOrbit() {
        isOrbiting = !isOrbiting;
        const orbits = document.querySelectorAll('.orbit');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');

        orbits.forEach(orbit => {
            orbit.style.animationPlayState = isOrbiting ? 'running' : 'paused';
        });

        if (isOrbiting) {
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
        } else {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }
    }

    // --- Mode and Fullscreen Helpers ---
    let currentMode = 'spin'; // 'spin' or 'static'
    function toggleMode() {
        const viewport = document.getElementById('solar-system-viewport');
        const btn = document.getElementById('mode-toggle');
        if (currentMode === 'spin') {
            currentMode = 'static';
            viewport.classList.remove('mode-spin');
            viewport.classList.add('mode-static');
            // remove spin animation from planets
            document.querySelectorAll('.planet').forEach(p => p.classList.remove('spin'));
            if (btn) btn.textContent = 'Mode: Statis';
        } else {
            currentMode = 'spin';
            viewport.classList.remove('mode-static');
            viewport.classList.add('mode-spin');
            // add spin class to planets
            document.querySelectorAll('.planet').forEach(p => p.classList.add('spin'));
            if (btn) btn.textContent = 'Mode: Putar';
        }
    }

    function toggleFullscreen() {
        const el = document.documentElement;
        if (!document.fullscreenElement) {
            el.requestFullscreen?.();
        } else {
            document.exitFullscreen?.();
        }
    }

    // Smooth zoom-to-planet
    function zoomToPlanet(el) {
        // compute center of element relative to viewport
        const rect = el.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2 - window.innerWidth / 2;
        const centerY = rect.top + rect.height / 2 - window.innerHeight / 2;
        // animate pan and zoom
        const targetZoom = Math.min(2.5, 1.5 + (3 - currentZoom));
        const startZoom = currentZoom;
        const startPan = { ...panOffset };
        const targetPan = { x: panOffset.x - centerX, y: panOffset.y - centerY };
        const duration = 600;
        const start = performance.now();
        function step(ts) {
            const t = Math.min(1, (ts - start) / duration);
            const ease = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
            currentZoom = startZoom + (targetZoom - startZoom) * ease;
            panOffset.x = startPan.x + (targetPan.x - startPan.x) * ease;
            panOffset.y = startPan.y + (targetPan.y - startPan.y) * ease;
            updateTransform();
            if (t < 1) requestAnimationFrame(step);
        }
        requestAnimationFrame(function run(ts) {
            step(ts);
            // when finished (approx), open closeup
        });
        // estimate show closeup after duration
        const key = el.dataset ? el.dataset.planet : null;
        setTimeout(() => { if (key) showCloseupForPlanet(key); }, 700);
    }

    // --- Auto-tour ---
    let tourRunning = false;
    let tourIndex = 0;
    let tourTimer = null;
    const planetKeys = Object.keys(planetData);
    function startTour() {
        if (tourRunning) return;
        tourRunning = true;
        document.getElementById('tour-toggle').textContent = 'Hentikan Tur';
        tourIndex = 0;
        runTourStep();
    }
    function stopTour() {
        tourRunning = false;
        document.getElementById('tour-toggle').textContent = 'Mulai Tur';
        if (tourTimer) { clearTimeout(tourTimer); tourTimer = null; }
    }
    function runTourStep() {
        if (!tourRunning) return;
        if (tourIndex >= planetKeys.length) { stopTour(); return; }
        const key = planetKeys[tourIndex++];
        // find element with data-planet=key
        const el = document.querySelector(`[data-planet="${key}"]`);
        if (el) {
            zoomToPlanet(el);
        }
        // show closeup after zoom (zoomToPlanet already does), then wait 3s before next
        tourTimer = setTimeout(() => { runTourStep(); }, 4000);
    }

    // Close-up panel functions
    function showCloseupForPlanet(planetKey) {
        const data = planetData[planetKey];
        if (!data) return;
        const panel = document.getElementById('closeup-panel');
        panel.querySelector('.title').textContent = data.name;
        panel.querySelector('.desc').textContent = data.description;
        panel.querySelector('.distance').textContent = data.distance;
        panel.querySelector('.diameter').textContent = data.diameter;
        const img = panel.querySelector('img.thumb');
        // prefer explicit image path from data, else try key-based filename, else try name-no-space
        const candidates = [];
        if (data.image) candidates.push(data.image);
        candidates.push(`item/${planetKey}.jpg`);
        candidates.push(`item/${data.name.replace(/\s+/g,'')}.jpg`);
        // placeholder SVG data url
        const placeholder = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="250"><rect width="100%" height="100%" fill="#0b1220"/><text x="50%" y="50%" fill="#9aa7bf" font-size="20" font-family="Poppins, Arial" dominant-baseline="middle" text-anchor="middle">Gambar tidak tersedia</text></svg>');
        let tried = 0;
        function tryNext() {
            if (tried >= candidates.length) { img.src = placeholder; return; }
            const src = candidates[tried++];
            img.onerror = tryNext;
            img.src = src;
        }
        tryNext();
        // open and trap focus
        panel.classList.add('open');
        panel.setAttribute('aria-hidden','false');
        setTimeout(() => trapFocus(panel), 120);
    }
    function hideCloseup() { const panel = document.getElementById('closeup-panel'); panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); releaseFocus(panel); }

    // --- Fungsi Efek Visual ---
    function createStarfield() {
        const canvas = document.getElementById('stars-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let stars = [];
        for (let i = 0; i < 500; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.5,
                alpha: Math.random(),
                dAlpha: Math.random() * 0.02 - 0.01
            });
        }

        function drawStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                ctx.fill();
                
                star.alpha += star.dAlpha;
                if (star.alpha > 1) { star.alpha = 1; star.dAlpha *= -1; }
                if (star.alpha < 0) { star.alpha = 0; star.dAlpha *= -1; }
            });
            requestAnimationFrame(drawStars);
        }
        drawStars();
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    }

    function createShootingStars() {
        setInterval(() => {
            const star = document.createElement('div');
            star.className = 'shooting-star';
            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight * 0.5;
            const duration = Math.random() * 2 + 1;
            
            star.style.top = `${startY}px`;
            star.style.left = `${startX}px`;
            star.style.animationDuration = `${duration}s`;
            
            document.body.appendChild(star);
            setTimeout(() => star.remove(), duration * 1000);
        }, 3000);
    }
    
    // --- Logika Kuis ---
    let currentQuestionIndex = 0;
    let score = 0;

    function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById('quiz-content').style.display = 'block';
        document.getElementById('quiz-result').classList.add('hidden');
        quizModal.classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const question = quizQuestions[currentQuestionIndex];
        document.getElementById('quiz-question').textContent = question.question;
        const optionsContainer = document.getElementById('quiz-options');
        optionsContainer.innerHTML = '';
        document.getElementById('quiz-feedback').textContent = '';

        question.options.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option;
            // Tailwind-like focus polish for kids: friendly ring + slight lift
            button.className = 'quiz-option p-4 rounded-lg text-lg focus:outline-none focus-visible:ring-6 focus-visible:ring-indigo-300';
            button.setAttribute('role', 'button');
            button.setAttribute('tabindex', '0');
            button.setAttribute('aria-pressed', 'false');
            button.onclick = () => selectAnswer(option, question.answer, button);
            button.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); button.click(); } });
            optionsContainer.appendChild(button);
        });
    }

    function selectAnswer(selected, correct, button) {
        document.querySelectorAll('.quiz-option').forEach(btn => btn.disabled = true);
        const feedback = document.getElementById('quiz-feedback');
        
        if (selected === correct) {
            score++;
            button.classList.add('correct');
            feedback.textContent = "Benar! Hebat!";
            feedback.style.color = '#2ecc71';
        } else {
            button.classList.add('incorrect');
            feedback.textContent = `Salah. Jawaban yang benar adalah ${correct}.`;
            feedback.style.color = '#e74c3c';
        }
        
        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }, 2000);
    }

    function showResults() {
        document.getElementById('quiz-content').style.display = 'none';
        document.getElementById('quiz-result').classList.remove('hidden');
        document.getElementById('quiz-score').textContent = score;
        document.getElementById('quiz-total').textContent = quizQuestions.length;
    }


    init();
});
</script>

<script>
// Accessibility: show keyboard-mode when user navigates with keyboard (Tab)
// and hide it when user uses mouse or touch â€” keeps focus styles friendly for kids.
;(function(){
    let keyboardMode = false;
    function enableKeyboardMode() {
        if (keyboardMode) return;
        keyboardMode = true;
        document.body.classList.add('keyboard-mode');
    }
    function disableKeyboardMode() {
        if (!keyboardMode) return;
        keyboardMode = false;
        document.body.classList.remove('keyboard-mode');
    }

    window.addEventListener('keydown', (e) => { if (e.key === 'Tab') enableKeyboardMode(); });
    window.addEventListener('mousedown', () => { disableKeyboardMode(); });
    window.addEventListener('touchstart', () => { disableKeyboardMode(); }, {passive:true});
    // also hide hint when clicking with mouse
    document.addEventListener('click', () => { const hint = document.getElementById('keyboard-hint'); if (hint) hint.classList.remove('visible'); });
})();
</script>

<!-- Kid-friendly focus application script
         This small script auto-applies the `kid-focus` helper class to common interactive elements
         (buttons, links, inputs, the sun/planets/moon). It does not change behavior â€” only visual
         focus styling for keyboard users. To disable, remove or comment out this script.
-->
<script>
    (function applyKidFocus(){
        const selectors = ['button', 'a[href]', 'input', 'select', 'textarea', '.planet', '.sun', '.moon', '.control-button', '.quiz-option'];
        const els = Array.from(document.querySelectorAll(selectors.join(',')));
        els.forEach(el => {
            // avoid overwriting existing classes; only add if not present
            if (!el.classList.contains('kid-focus')) el.classList.add('kid-focus');
            // ensure all planets and circular items are focusable for keyboard navigation
            if ((el.classList && (el.classList.contains('planet') || el.classList.contains('sun') || el.classList.contains('moon'))) && !el.hasAttribute('tabindex')) {
                el.setAttribute('tabindex', '0');
            }
        });

        // Optional: announce enhancement to assistive tech (non-intrusive)
        const announcer = document.getElementById('announcer');
        if (announcer) announcer.textContent = 'Mode fokus ramah anak diaktifkan';
    })();
</script>

<!-- Close-up panel -->
<div id="closeup-panel" class="fixed left-1/2 bottom-0 transform -translate-x-1/2 translate-y-full w-[96%] max-w-4xl bg-gradient-to-b from-slate-900/90 to-black/95 rounded-t-xl p-4 z-60" role="region" aria-labelledby="closeup-title" aria-hidden="true">
    <div class="flex items-start gap-4">
        <img class="thumb" src="" alt="Planet image">
        <div class="flex-1">
            <div class="flex items-center justify-between">
                <h3 id="closeup-title" class="title text-2xl font-bold text-white"></h3>
                <button id="closeup-close" class="control-button px-3 py-1 rounded text-white">Tutup</button>
            </div>
            <p class="desc mt-2 text-sm text-gray-200"></p>
            <div class="mt-3 grid grid-cols-2 gap-3 text-sm text-white">
                <div>
                    <h4 class="text-xs text-gray-400">Jarak</h4>
                    <div class="distance font-semibold"></div>
                </div>
                <div>
                    <h4 class="text-xs text-gray-400">Diameter</h4>
                    <div class="diameter font-semibold"></div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
